<!DOCTYPE html>
<html>
<head>
  <title>JavaScript View</title>

  <script type="text/javascript">

    // variável global para armazenar o Base64
    let logoBase64 = null;
	  
    window.onload = function(){
      printerInternalImpStart();
      preloadLogo();   // carrega o logo uma única vez
    }
	    
    function preloadLogo() {
      fetch('teste-logo-GAF.jpg')
        .then(res => {
          if (!res.ok) throw new Error('Não encontrou o logo');
          return res.blob();
        })
        .then(blob => {
          const reader = new FileReader();
          reader.onloadend = () => {
            logoBase64 = reader.result;   // data:image/jpeg;base64,...
            console.log('Logo pré-carregado');
          };
          reader.readAsDataURL(blob);
        })
        .catch(err => {
          console.error('Erro ao pré-carregar logo:', err);
          androidApp.makeToast('Falha ao pré-carregar logo', true);
        });
    }

   function imprimeticket1() {
      fetch('ticket1.jpg')
        .then(res => {
          if (!res.ok) throw new Error('Não encontrou o ticket1');
          return res.blob();
        })
        .then(blob => {
          const reader = new FileReader();
          reader.onloadend = () => {
            logoBase64 = reader.result;   // data:image/jpeg;base64,...
	    androidApp.imprimeImagem(reader.result);
            console.log('ticket1 pré-carregado');
          };
          reader.readAsDataURL(blob);
        })
        .catch(err => {
          console.error('Erro ao pré-carregar ticket1:', err);
          androidApp.makeToast('Falha ao pré-carregar ticket1', true);
        });
    }

    function imprimeticket2() {
      fetch('ticket2.jpg')
        .then(res => {
          if (!res.ok) throw new Error('Não encontrou o ticket2');
          return res.blob();
        })
        .then(blob => {
          const reader = new FileReader();
          reader.onloadend = () => {
            androidApp.imprimeImagem(reader.result);		  
            console.log('Ticket2 pré-carregado');
          };
          reader.readAsDataURL(blob);
        })
        .catch(err => {
          console.error('Erro ao pré-carregar ticket2:', err);
          androidApp.makeToast('Falha ao pré-carregar ticket2', true);
        });
    }

    function printerInternalImpStart(){
        var lengthLong = true;
        var message = "Conectando Impressora Interna";

        androidApp.makeToast(message, lengthLong);

        androidApp.printerInternalImpStart();
    }

    function imprimeLogo() {
      if (!logoBase64) {
        androidApp.makeToast('Logo ainda não carregado', true);
        return;
      }
      androidApp.imprimeImagem(logoBase64);
    }

    function imprimeTexto() {
        var lengthLong = true;
        var message = "Conectando Impressora Interna";

        androidApp.makeToast("Imprimindo Texto", lengthLong);

        var inputText = document.getElementById("textoImpressora").value

	imprimeLogo();
	    
        var params = { text: "EMPRESA TESTE \n LEANDRO \n",
                       align: "Centralizado",
                       font: "FONT A",
                       fontSize: 17,
                       isUnderline: false,
                       isBold: true}
        androidApp.imprimeTexto(JSON.stringify(params));
		
		var params = { text: "EMPRESA TESTE LEANDRO",
                       align: "Centralizado",
                       font: "FONT A",
                       fontSize: 17,
                       isUnderline: false,
                       isBold: false }
        androidApp.imprimeTexto(JSON.stringify(params));
		
		var params = { text: "______________________________________________\n",
                       align: "Centralizado",
                       font: "FONT A",
                       fontSize: 0,
                       isUnderline: false,
                       isBold: false}
        androidApp.imprimeTexto(JSON.stringify(params));
		
		var params = { text: "CAIXA CONVENCIONAL",
                       align: "Centralizado",
                       font: "FONT A",
                       fontSize: 0,
                       isUnderline: false,
                       isBold: true}
        androidApp.imprimeTexto(JSON.stringify(params));
		
		var params = { text: "08:00 ÀS 18:00",
                       align: "Centralizado",
                       font: "FONT A",
                       fontSize: 0,
                       isUnderline: false,
                       isBold: false }
        androidApp.imprimeTexto(JSON.stringify(params));
		
				
		var params = { text: "00001",
                       align: "Centralizado",
                       font: "FONT A",
                       fontSize: 17,
                       isUnderline: false,
                       isBold: true }
        androidApp.imprimeTexto(JSON.stringify(params));
		
		
				var params = { text: "Segunda-feira, 31/07/2023",
                       align: "Centralizado",
                       font: "FONT A",
                       fontSize: 0,
                       isUnderline: false,
                       isBold: true}
        androidApp.imprimeTexto(JSON.stringify(params));
		
				var params = { text: "12:52",
                       align: "Centralizado",
                       font: "FONT A",
                       fontSize: 0,
                       isUnderline: false,
                       isBold: true}
        androidApp.imprimeTexto(JSON.stringify(params));
		
						var params = { text: "* a previsao de antendimento pode ser alterada",
                       align: "Centralizado",
                       font: "FONT B",
                       fontSize: 0,
                       isUnderline: false,
                       isBold: true}
        androidApp.imprimeTexto(JSON.stringify(params));
		
				var params = { text: "______________________________________________\n",
                       align: "Centralizado",
                       font: "FONT A",
                       fontSize: 0,
                       isUnderline: false,
                       isBold: false}
        androidApp.imprimeTexto(JSON.stringify(params));
		
		var params = { qrSize: 4,
                       text: "CentralizadoCentralizadoCentralizadoCentralizadoCentralizadoCentralizadoCentralizadoCentralizadoCentralizadoCentralizadoCentralizadoCentralizadoCentralizadoCentralizadoCentralizadoCentralizadoCentralizadoCentralizado",
                       align: "Centralizado" }
        androidApp.imprimeQR(JSON.stringify(params));
		
		
						var params = { text: "SMART CODE: SC-M38CX",
                       align: "Centralizado",
                       font: "FONT A",
                       fontSize: 0,
                       isUnderline: false,
                       isBold: false }
        androidApp.imprimeTexto(JSON.stringify(params));
		
		
		var params = {   quant: 10 }
		androidApp.cutPaper(JSON.stringify(params));
		
    }
	
		    function modoKioskOff() {
        androidApp.modoKioskOff();
    }
		function modoKioskOn() {
        androidApp.modoKioskOn();
    }

    const printTicket = async () => {
    const ticket = {
      unit: 'Unidade Central',
      unitService: 'Caixa',
      description: 'Serviço de Pagamento de Contas, Saques e Depósitos',
      display_number: 'CX0020',
      customerName: 'João da Silva',
      customerIdentifier: '+55 11 99988-7766',
      attendant: 'Silvia Silva',
      local: 'Mesa 04',
      footer: '21/08/2023 • 14:58:20 • Octogenário 80+ ',
      logo: 'iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNk+A8AAQUBAScY42YAAAAASUVORK5CYII=',
    };

    window.ReactNativeWebView.postMessage(
      JSON.stringify({
        type: 'ticket',
        payload: ticket,
      }),
    );
  };
 

  </script>
</head>

<body>
  <h1>Exemplo WebView</h1>
  <input id="textoImpressora" type="text" value="Hello World!" placeholder="Digite seu texto" />
  <button id="btnImprimirTexto" onclick="imprimeTexto()" type="button">
    Imprimir
  </button>
    <button id="btnImprimirTexto" onclick="modoKioskOff()" type="button">
    modoKioskOff()
  </button>
    <button id="btnImprimirTexto" onclick="imprimeTexto()" type="button">
    modoKioskOn()
  </button>
  </button>
    <button id="btnImprimirGAF" onclick="printTicket()" type="button">
	ImprimirGAF
  </button>
	</button>
    <button id="btnImprimirGAF" onclick="imprimeticket1()" type="button">
	Ticket1
  </button>
  </button>
  <button id="btnImprimirGAF" onclick="imprimeticket2()" type="button">
	Ticket2
  </button>
</body>
</html>
